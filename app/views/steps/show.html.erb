
<%= javascript_include_tag 'steps' %>

<div class="show-action-header" %>
  <div class="container overlay">

    <h2> Step # <%= @step.stepNo %> of <%= @step.change.name.slice(0, 20) %></h2>
    <h5> &emsp; <%= @step.action %> </h5>

    <hr/>
    <%= link_to '<i class="glyphicon glyphicon-plus">  </i> More info'.html_safe, edit_step_path(@step), style: 'color: white'; %>
    |
    <%= link_to '<i class="glyphicon glyphicon-edit">  </i> Edit change'.html_safe, edit_step_path(@step), style: 'color: white'; %>
    |
    <%= link_to '<i class="glyphicon glyphicon-th-large">  </i> Clone to'.html_safe, edit_step_path(@step), style: 'color: white'; %>
    |
    <%= link_to '<i class="glyphicon glyphicon-folder-close">  </i> Close request'.html_safe, edit_step_path(@step), style: 'color: white'; %>

  </div>
</div>

<%= render 'layouts/messages' %>

<div class="container">

  <br/>
  <h4><a href="#" id="add-log"> + Create new Log </a></h4>
  <hr/>


  <%= bootstrap_form_for :upload, {:url => steps_log_upload_path, :html => {:multipart => true}} do |f| %>

      <div id="j--hide" class="panel panel-primary">
        <div class="panel-heading ">
          + New Log </h6>  <%= submit_tag("Submit form", class: "btn btn-info") %>
        </div>

        <div class="panel-body">
          <%= f.file_field('file', class: "btn btn-info", label: "Upload a file:") %>
          <br/>
          <%= f.text_area :text_field_log, style: "width: 100%;", rows: "10" %>
        </div>

        <div class="panel-footer">
          <%= submit_tag("Submit form", class: "btn btn-info", label: "Paste your text log:") %>
        </div>
      </div>
  <% end %>


  <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

    <% counter = 0 %>
    <% @step.logs.each do |log| %>

        <div class="panel panel-info">
          <div class="panel-heading" role="tab" id="<%= "h_#{log.id}" %>">
            <h4 class="panel-title">
              <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="<%= "#c_#{log.id}" %>" aria-expanded="false" aria-controls=<%= "c_#{log.id}" %>>
                <%= "Log# #{counter = counter +1}" %>
              </a>
            </h4>
          </div>
          <div id="<%= "c_#{log.id}" %>" class="panel-collapse collapse" role="tabpanel" aria-labelledby="<%= "h_#{log.id}" %>">
            <div class="panel-body">

              <%= link_to("Downaload #{log.file_name}", steps_download_url(:log => log)) %>
              <% if log.mime_type = 'text/plain' %>
                  <pre>
                    <%= render :file => log.log_path + log.file_name %>
                  </pre>
              <% end %>
            </div>
          </div>
        </div>

    <% end %>

    <% if counter == 0 %>
        <hr/>
        <h3>No log for this step</h3>

    <% end %>

  </div>
</div>





